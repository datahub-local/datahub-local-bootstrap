traefik_helm_values:
  # https://github.com/traefik/traefik-helm-chart/blob/master/traefik/values.yaml

  deployment:
    kind: DaemonSet

  service:
    type: ClusterIP
    externalTrafficPolicy: "Local"

  hostNetwork: true

  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: kubernetes.io/hostname
                operator: In
                values:
                  - datahublocal-orpi-1
                  - datahublocal-orpi-2
                  - datahublocal-orpi-3

  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 0

  resources:
    requests:
      memory: "256Mi"
      cpu: "500m"
    limits:
      memory: "512Mi"

  securityContext:
    capabilities:
      drop: [ALL]
      add: [NET_BIND_SERVICE]
    readOnlyRootFilesystem: true
    runAsGroup: 0
    runAsNonRoot: false
    runAsUser: 0
  podSecurityContext:
    fsGroup: 0

  ports:
    traefik:
      port: 39000
      expose:
        default: true
      exposedPort: 39000
    web:
      port: 80
      http:
        redirections:
          entryPoint:
            to: websecure
            scheme: https
            permanent: true
    websecure:
      port: 443
    metrics:
      port: 39100
      expose:
        default: true
      exposedPort: 39100

  providers:
    kubernetesCRD:
      enabled: true
      allowCrossNamespace: true
      allowExternalNameServices: true
    kubernetesIngress:
      enabled: false
    kubernetesGateway:
      enabled: false

  ingressClass:
    enabled: false

  api:
    dashboard: true
    insecure: true

  additionalArguments:
    - "--api.insecure=true"

  ingressRoute:
    dashboard:
      enabled: false

  logs:
    general:
      level: INFO
    access:
      enabled: true
      format: json
      # filters:
      #   statuscodes: "200,300-302"
      #   retryattempts: true
      #   minDuration: "10ms"
      fields:
        defaultMode: keep
        names:
          ClientUsername: drop
        headers:
          defaultMode: keep
          names:
            User-Agent: redact
            Authorization: drop

  metrics:
    prometheus:
      entryPoint: metrics
      service:
        enabled: true
      addEntryPointsLabels: true
      addServicesLabels: true
      disableAPICheck: true
      serviceMonitor:
        enabled: true

  extraObjects:
    - apiVersion: traefik.io/v1alpha1
      kind: IngressRoute
      metadata:
        name: traefik-web-ui
        annotations:
          gethomepage.dev/enabled: "true"
          gethomepage.dev/name: "Traefik"
          gethomepage.dev/group: "System"
          gethomepage.dev/icon: "si-traefikproxy"
          gethomepage.dev/pod-selector: "app.kubernetes.io/name=traefik"
          gethomepage.dev/href: "https://system-traefik.{{ gateway_hostname }}/dashboard/"
      spec:
        entryPoints:
          - websecure
        routes:
          - match: Host(`system-traefik.{{ gateway_hostname }}`) && (PathPrefix(`/api/`) || PathPrefix(`/dashboard/`))
            kind: Rule
            services:
              - name: traefik
                port: 39000
            middlewares:
              - name: oauth2-proxy-auth
                namespace: security
          - match: Host(`system-traefik.{{ gateway_hostname }}`) && PathPrefix(`/oauth2/`)
            kind: Rule
            services:
              - name: oauth2-proxy
                namespace: security
                port: http
        tls:
          secretName: "{{ gateway_hostname }}-cert"

external_dns_secret_name:
external_dns_secret_data:
external_dns_helm_values:
